<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch s·ª≠ h√≥a ƒë∆°n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lshoadon.css') }}"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><img src="./static/data/bus.png" alt="My Bus Logo" class="logo"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/">Trang ch·ªß</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/lichtrinh">L·ªãch tr√¨nh</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/ttlienhe">Li√™n h·ªá</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/lshoadon">H√≥a ƒë∆°n</a>
                </li>
                <li><a class="nav-link" href="/datve">ƒê·∫∑t v√©</a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="container my-5">
    <h1>L·ªãch s·ª≠ h√≥a ƒë∆°n</h1>
    <!--    Danh s√°ch h√≥a ƒë∆°n-->
    <div class="card">
        <div class="card-header">
            <h5>Danh s√°ch h√≥a ƒë∆°n</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <div class="col-1">
                            <th>M√£ v√©</th>
                        </div>
                        <div class="col-1">
                            <th>S·ªë v√©</th>
                        </div>
                        <div class="col-2">
                            <th>T√™n chuy·∫øn ƒëi</th>
                        </div>
                        <div class="col-2">
                            <th>Th·ªùi ƒëi·ªÉm ƒëi</th>
                        </div>
                        <div class="col-2">
                            <th>Ng√†y l·∫≠p h√≥a ƒë∆°n</th>
                        </div>
                        <div class="col-2">
                            <th>Gi√° v√©</th>
                        </div>
                        <div class="col-2">
                            <th>T√¨nh tr·∫°ng</th>
                        </div>
                        <div class="col-2">
                            <th></th>
                        </div>
                    </tr>
                    </thead>
                    <tbody>
                    {% for invoice in data.invoices %}
                        <tr>
                            <div class="col-1">
                                <td>{{ invoice.ticket_id }}</td>
                            </div>
                            <div class="col-1">
                                <td>{{ invoice.seat }}</td>
                            </div>
                            <div class="col-2">
                                <td>{{ invoice.route }}</td>
                            </div>
                            <div class="col-2">
                                <td>{{ invoice.date }}</td>
                            </div>
                            <div class="col-2">
                                <td>{{ invoice.created_date }}</td>
                            </div>
                            <div class="col-2">
                                <td>{{ invoice.amount }}</td>
                            </div>
                            <div class="col-2">
                                <td>{{ invoice.status }}</td>
                            </div>

                            <td>
                                <a href="javascript:void(0);"
                                   onclick="showInvoiceDetails('{{ invoice.ticket_id }}', '{{ invoice.seat }}', '{{ invoice.route }}', '{{ invoice.date }}', '{{ invoice.created_date }}', '{{ invoice.amount }}', '{{ invoice.status }}')"
                                   class="text-info">Chi ti·∫øt</a>
                                <a href="javascript:void(0)" onclick="deleteInvoice('{{ invoice.ticket_id }}')"
                                   class="text-danger ms-2">X√≥a</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <h5 class="text-end mt-4">T·ªïng: {{ data.total_amount }} ƒë</h5>
        </div>

        <div id="invoice-detail" class="card mt-5" style="display: none">
            <div class="card-body" id="invoice-detail-content">
                <!-- N·ªôi dung chi ti·∫øt h√≥a ƒë∆°n s·∫Ω ƒë∆∞·ª£c JavaScript th√™m v√†o ƒë√¢y -->
            </div>
        </div>

        <!--    Chi ti·∫øt h√≥a ƒë∆°n-->
        <div class="col-md-8-cen-8 my-4" id="invoiceDetailModal" tabindex="-1" aria-labelledby="invoiceDetailModalLabel"
             aria-hidden="true" style="display: none">
            <div class="card">
                <div class="card-header text-danger font-weight-bold">
                    Chi ti·∫øt h√≥a ƒë∆°n
                    <div class="float-end">
                        <a href="#" onclick="window.print()" class="text-dark mx-3">üñ® In</a>
                        <a href="{{ url_for('generate_pdf') }}" class="text-dark mx-3">üìÑ Xu·∫•t PDF</a>
                        <button type="button" class="btn-close mx-2" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                </div>
                <div class="card-body my-2">
                    <h4>H√ìA ƒê∆†N</h4>
                    <h5>Th√¥ng tin kh√°ch h√†ng</h5>
                    <p><strong>T√™n kh√°ch h√†ng:</strong> Th·∫ø Nguy√™n</p>
                    <p><strong>Email:</strong> phamthenguyen2004@gmail.com</p>
                    <p><strong>SDT:</strong> 0932109822</p>
                    <p><strong>ƒê·ªãa ch·ªâ:</strong> Q. T√¢n Ph√∫, TP.HCM</p>
                    <!--                    <br>-->
                    <!--                    <br>-->
                    <!--                    <h5>Th√¥ng tin h√≥a ƒë∆°n</h5>-->
                    <!--                    {% for invoice in data.invoices %}-->
                        <!--                        <p><strong>M√£ v√©:</strong>{{ invoice.ticket_id }}</p>-->
                        <!--                        <p><strong>S·ªë v√©:</strong>{{ invoice.seat }}</p>-->
                        <!--                        <p><strong>T√™n chuy·∫øn ƒëi:</strong>{{ invoice.root }}</p>-->
                        <!--                        <p><strong>Th·ªùi ƒëi·ªÉm ƒëi:</strong>{{ invoice.date }}</p>-->
                        <!--                        <p><strong>Ng√†y l·∫≠p h√≥a ƒë∆°n:</strong>{{ invoice.created_date }}</p>-->
                        <!--                        <p><strong>Gi√° v√©:</strong>{{ invoice.amount }}</p>-->
                        <!--                        <p><strong>T√¨nh tr·∫°ng:</strong>{{ invoice.status }}</p>-->
                        <!--                    {% endfor %}-->
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function showInvoiceDetail(invoice) {
        const detailSection = document.getElementById('invoice-detail');
        const detailContent = document.getElementById('invoice-detail-content');
        detailContent.innerHTML =
            `
            <h5>Chi ti·∫øt h√≥a ƒë∆°n</h5>
            <p><strong>M√£ v√©:</strong> ${invoice.ticket_id}</p>
            <p><strong>S·ªë v√©:</strong> ${invoice.seat}</p>
            <p><strong>T√™n chuy·∫øn xe:</strong> ${invoice.route}</p>
            <p><strong>Th·ªùi ƒëi·ªÉm ƒëi:</strong> ${invoice.date}</p>
            <p><strong>Ng√†y l·∫≠p h√≥a ƒë∆°n:</strong> ${invoice.created_date}</p>
            <p><strong>Gi√° v√©:</strong> ${invoice.amount} ƒë</p>
            <p><strong>T√¨nh tr·∫°ng:</strong> ${invoice.status}</p>
            `;
        detailSection.style.display = 'block';
    }

    function deleteInvoice(ticketId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h√≥a ƒë∆°n n√†y?")) {
            fetch(`/delete_invoice/${ticketId}`, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    alert('H√≥a ƒë∆°n ƒë√£ ƒë∆∞·ª£c x√≥a');
                    location.reload();
                } else {
                    alert('Kh√¥ng th·ªÉ x√≥a h√≥a ƒë∆°n');
                }
            });
        }
    }

    function showInvoiceDetails(ticket_id, seat, route, date, created_date, amount, status) {
        // C·∫≠p nh·∫≠t n·ªôi dung modal v·ªõi th√¥ng tin h√≥a ƒë∆°n
        document.getElementById("detailTicketId").innerText = ticket_id;
        document.getElementById("detailSeat").innerText = seat;
        document.getElementById("detailRoute").innerText = route;
        document.getElementById("detailDate").innerText = date;
        document.getElementById("detailCreatedDate").innerText = created_date;
        document.getElementById("detailAmount").innerText = amount;
        document.getElementById("detailStatus").innerText = status;

        // Hi·ªÉn th·ªã modal
        var invoiceModal = new bootstrap.Modal(document.getElementById("invoiceDetailModal"));
        invoiceModal.show();
    }
</script>
</body>
</html>
